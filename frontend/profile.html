<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Profile - PublicVision</title>
<link rel="stylesheet" href="css/styles.css" />
<link rel="stylesheet" href="css/dashboard.css" />
<link rel="stylesheet" href="css/responsive.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<style>
.profile-wrapper { max-width:960px; margin:90px auto 60px; display:grid; gap:1.5rem; grid-template-columns:280px 1fr; }
@media(max-width:880px){ .profile-wrapper{ grid-template-columns:1fr; margin-top:80px; } }
.profile-card, .profile-section { background:#fff; border-radius:16px; padding:1.4rem 1.5rem 1.25rem; box-shadow:0 8px 24px -8px rgba(23,43,77,.15),0 4px 6px -2px rgba(23,43,77,.08);} 
.profile-card-header{ text-align:center; }
.profile-avatar{ width:110px; height:110px; margin:0 auto 1rem; border-radius:50%; background:linear-gradient(135deg,#4e8cff,#6f5bff); display:flex; align-items:center; justify-content:center; color:#fff; font-size:3rem; box-shadow:0 6px 16px -4px rgba(78,140,255,.6);} 
.profile-meta{ font-size:.8rem; color:#5a6b7b; margin-top:.3rem; letter-spacing:.5px; }
.form-grid{ display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); }
.form-group label{ font-weight:600; font-size:.75rem; letter-spacing:.6px; text-transform:uppercase; color:#5a6b7b; display:block; margin-bottom:.35rem; }
.form-group input{ width:100%; padding:.6rem .7rem; border:1px solid #d8e1eb; border-radius:10px; background:#f8fafc; font-size:.85rem; transition:border-color .2s, background .2s; }
.form-group input:focus{ outline:none; border-color:#4e8cff; background:#fff; }
.section-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:.85rem; }
.section-header h2{ margin:0; font-size:1rem; letter-spacing:.5px; font-weight:600; color:#182635; }
.btn-inline{ display:inline-flex; align-items:center; gap:.4rem; }
.alert{ margin-top:1rem; display:none; }
.password-rules{ font-size:.65rem; line-height:1.2; color:#6b7e90; margin-top:.3rem; }
</style>
</head>
<body class="dashboard-body">
<nav class="navbar">
 <div class="container">
  <div class="navbar-brand"><a href="index.html"><h1>PublicVision</h1></a></div>
  <div class="navbar-menu" id="navbarMenu">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="complaints.html">Complaints</a></li>
      <li><a href="statistics.html">Statistics</a></li>
      <li><a href="about.html">About</a></li>
      <li class="user-menu"><a href="dashboard.html">Dashboard</a></li>
    </ul>
  </div>
  <div class="navbar-toggle" id="navbarToggle"><span></span><span></span><span></span></div>
 </div>
</nav>
<div class="profile-wrapper">
  <aside class="profile-card" id="profileSummary">
    <div class="profile-card-header">
      <div class="profile-avatar" id="profileAvatar"><i class="fas fa-user"></i></div>
      <h2 id="profileName">User</h2>
      <div class="profile-meta" id="profileEmail">email@example.com</div>
      <div class="profile-meta" id="profileRole">Role: Citizen</div>
      <div class="profile-meta" id="profileJoined"></div>
    </div>
  </aside>
  <main class="profile-main">
    <section class="profile-section">
      <div class="section-header"><h2>Account Information</h2><button class="btn btn-primary btn-inline" id="refreshProfile"><i class="fas fa-rotate"></i> Refresh</button></div>
      <form id="profileForm">
        <div class="form-grid">
          <div class="form-group"><label for="name">Name</label><input type="text" id="name" name="name" required></div>
          <div class="form-group"><label for="email">Email</label><input type="email" id="email" name="email" readonly></div>
          <div class="form-group"><label for="phone">Phone</label><input type="tel" id="phone" name="phone"></div>
        </div>
        <button type="submit" class="btn btn-primary" style="margin-top:1rem;">Save Changes</button>
        <div class="alert alert-success" id="profileSuccess"></div>
        <div class="alert alert-danger" id="profileError"></div>
      </form>
    </section>
    <section class="profile-section">
      <div class="section-header"><h2>Change Password</h2></div>
      <form id="passwordForm">
        <div class="form-grid">
          <div class="form-group"><label for="currentPassword">Current Password</label><input type="password" id="currentPassword" name="currentPassword" required></div>
          <div class="form-group"><label for="newPassword">New Password</label><input type="password" id="newPassword" name="newPassword" required></div>
          <div class="form-group"><label for="confirmNewPassword">Confirm New Password</label><input type="password" id="confirmNewPassword" name="confirmNewPassword" required></div>
        </div>
        <div class="password-rules">Min 6 chars, include upper, lower, number & special.</div>
        <button type="submit" class="btn btn-outline" style="margin-top:1rem;">Update Password</button>
        <div class="alert alert-success" id="passwordSuccess"></div>
        <div class="alert alert-danger" id="passwordError"></div>
      </form>
    </section>
  </main>
</div>
<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/api.js"></script>
<script src="js/auth.js"></script>
<script>
if(!authApi.isAuthenticated()){ window.location.href='login.html?returnUrl='+encodeURIComponent('profile.html'); }
const profileSuccess=document.getElementById('profileSuccess');
const profileError=document.getElementById('profileError');
const passwordSuccess=document.getElementById('passwordSuccess');
const passwordError=document.getElementById('passwordError');
function show(el,msg){ el.textContent=msg; el.style.display='block'; }
function hideAll(){[profileSuccess,profileError,passwordSuccess,passwordError].forEach(e=>{e.style.display='none';});}
async function loadProfile(){ hideAll(); try{ const data= await userApi.getProfile(); document.getElementById('name').value=data.name||''; document.getElementById('email').value=data.email||''; document.getElementById('phone').value=data.phone||''; document.getElementById('profileName').textContent=data.name||'User'; document.getElementById('profileEmail').textContent=data.email; document.getElementById('profileRole').textContent='Role: '+(data.role||'Citizen'); if(data.createdAt){ document.getElementById('profileJoined').textContent='Joined: '+ new Date(data.createdAt).toLocaleDateString(); } }catch(err){ show(profileError,err.message||'Failed to load profile'); }}
loadProfile();
refreshProfile.onclick=loadProfile;
profileForm.addEventListener('submit', async e=>{ e.preventDefault(); hideAll(); const payload={ name:name.value.trim(), phone:phone.value.trim() }; try{ await userApi.updateProfile(payload); show(profileSuccess,'Profile updated'); loadProfile(); }catch(err){ show(profileError,err.message||'Update failed'); }});
passwordForm.addEventListener('submit', async e=>{ e.preventDefault(); hideAll(); const cur=currentPassword.value, np=newPassword.value, cp=confirmNewPassword.value; if(np!==cp){ show(passwordError,'Passwords do not match'); return;} try{ await userApi.changePassword(cur,np); show(passwordSuccess,'Password changed'); passwordForm.reset(); }catch(err){ show(passwordError,err.message||'Change failed'); }});
</script>
</body>
</html>